{% extends "adminlte/base.html" %}
{% load crispy_forms_tags %}

{% block content %}
<div class="card">
    <section class="card-body">
        <div class="card mx-auto" style="margin:0px;">
            <div class="card-header bg-primary text-white">
                <h1 class="card-title">
                    <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor" class="bi bi-person-fill-down" viewBox="0 0 16 16">
                        <path d="M12.5 9a3.5 3.5 0 1 1 0 7 3.5 3.5 0 0 1 0-7m.354 5.854 1.5-1.5a.5.5 0 0 0-.708-.708l-.646.647V10.5a.5.5 0 0 0-1 0v2.793l-.646-.647a.5.5 0 0 0-.708.708l1.5 1.5a.5.5 0 0 0 .708 0M11 5a3 3 0 1 1-6 0 3 3 0 0 1 6 0"/>
                        <path d="M2 13c0 1 1 1 1 1h5.256A4.5 4.5 0 0 1 8 12.5a4.5 4.5 0 0 1 1.544-3.393Q8.844 9.002 8 9c-5 0-6 3-6 4"/>
                      </svg>
                    Edit Staff for {{ school.school_name }}
                </h1>
            </div>

            <div class="card-body">
                <form method="post" enctype="multipart/form-data" id="staffForm">
                    {% csrf_token %}
                    
                    <!-- Bootstrap Tabs -->
                    <ul class="nav nav-tabs" id="staffFormTabs" role="tablist">
                        <li class="nav-item">
                            <a class="nav-link active" id="personal-info-tab" data-bs-toggle="tab" href="#personal-info" role="tab" aria-controls="personal-info" aria-selected="true">Personal Information</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" id="professional-details-tab" data-bs-toggle="tab" href="#professional-details" role="tab" aria-controls="professional-details" aria-selected="false">Professional Details</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" id="document-uploads-tab" data-bs-toggle="tab" href="#document-uploads" role="tab" aria-controls="document-uploads" aria-selected="false">Document Uploads</a>
                        </li>
                    </ul>

                    <!-- Tab Content -->
                    <div class="tab-content mt-3" id="staffFormTabsContent">
                        
                        <!-- Personal Information Section -->
                        <div class="tab-pane fade show active" id="personal-info" role="tabpanel" aria-labelledby="personal-info-tab">
                            <div class="card">
                                <div class="card-header bg-primary text-white">
                                    <h3 class="card-title">Personal Information</h3>
                                </div>
                                <div class="card-body bg-light">
                                    <div class="form-group">
                                        {{ form.first_name|as_crispy_field }}
                                    </div>
                                    <div class="form-group">
                                        {{ form.last_name|as_crispy_field }}
                                    </div>
                                    <div class="form-group">
                                        {{ form.email|as_crispy_field }}
                                    </div>
                                    <div class="form-group">
                                        {{ form.gender|as_crispy_field }}
                                    </div>
                                    <div class="form-group">
                                        {{ form.marital_status|as_crispy_field }}
                                    </div>
                                    <div class="form-group">
                                        {{ form.date_of_birth|as_crispy_field }}
                                    </div>
                                    <div class="form-group">
                                        {{ form.phone_number|as_crispy_field }}
                                    </div>
                                    <div class="form-group">
                                        {{ form.address|as_crispy_field }}
                                    </div>
                                    <div class="form-group">
                                        {{ form.nationality|as_crispy_field }}
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Professional Details Section -->
                        <div class="tab-pane fade" id="professional-details" role="tabpanel" aria-labelledby="professional-details-tab">
                            <div class="card">
                                <div class="card-header bg-primary text-white">
                                    <h3 class="card-title">Professional Details</h3>
                                </div>
                                <div class="card-body bg-light">
                                    <div class="form-group">
                                        {{ form.role|as_crispy_field }}
                                    </div>
                                    <div class="form-group">
                                        {{ form.branches|as_crispy_field }}
                                    </div>
                                    <div class="form-group">
                                        {{ form.staff_category|as_crispy_field }}
                                    </div>
                                    <div class="form-group">
                                        {{ form.status|as_crispy_field }}
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Document Uploads Section -->
                        <div class="tab-pane fade" id="document-uploads" role="tabpanel" aria-labelledby="document-uploads-tab">
                            <div class="card">
                                <div class="card-header bg-primary text-white">
                                    <h3 class="card-title">Document Uploads</h3>
                                </div>
                                <div class="card-body bg-light">
                                    <div class="form-group">
                                        {{ form.cv|as_crispy_field }}
                                    </div>
                                    <div class="form-group">
                                        {{ form.profile_picture|as_crispy_field }}
                                    </div>
                                    <div class="form-group">
                                        {{ form.staff_signature|as_crispy_field }}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card-footer d-flex justify-content-center">
                        <button type="submit" class="btn btn-primary" id="addStaffButton">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-person-plus-fill" viewBox="0 0 16 16">
                                <path d="M1 14s-1 0-1-1 1-4 6-4 6 3 6 4-1 1-1 1zm5-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6"/>
                                <path fill-rule="evenodd" d="M13.5 5a.5.5 0 0 1 .5.5V7h1.5a.5.5 0 0 1 0 1H14v1.5a.5.5 0 0 1-1 0V8h-1.5a.5.5 0 0 1 0-1H13V5.5a.5.5 0 0 1 .5-.5"/>
                              </svg>
                            Update Staff
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </section>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        function validateTab(tab) {
            var valid = true;
            var fields = tab.querySelectorAll('input, select, textarea');
            fields.forEach(function(field) {
                if (!field.checkValidity()) {
                    valid = false;
                    field.classList.add('is-invalid');
                } else {
                    field.classList.remove('is-invalid');
                }
            });
            return valid;
        }

        document.querySelectorAll('#staffFormTabs a[data-bs-toggle="tab"]').forEach(function(tabLink) {
            tabLink.addEventListener('show.bs.tab', function(event) {
                var currentTab = document.querySelector(event.relatedTarget.getAttribute('href'));
                if (!validateTab(currentTab)) {
                    event.preventDefault(); // Prevent switching to the next tab if the current tab is invalid
                    alert('Please fill in all required fields before proceeding to the next tab.');
                }
            });
        });
    });
</script>
{% endblock %}
